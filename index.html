<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Values Survey — Present vs 2075</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Load Plotly from CDN -->
  <script src="https://cdn.plot.ly/plotly-2.33.0.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 2rem;
      line-height: 1.4;
    }
    h1, h2 { margin: 0.5rem 0; }
    .wrap { display: grid; gap: 2rem; max-width: 1000px; }
    .card {
      border: 1px solid #ddd;
      border-radius: 16px;
      padding: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,.05);
    }
    .plot { width: 100%; height: 420px; }
    .controls { display: flex; align-items: center; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap; }
    .hint { font-size: 0.95rem; color: #333; }
    .muted { color: #666; font-size: 0.9rem; }
    button {
      border: none;
      border-radius: 999px;
      padding: 0.6rem 1rem;
      cursor: pointer;
    }
    button[disabled] { opacity: 0.5; cursor: not-allowed; }
    .ok { background: #0f766e; color: white; }
    .warn { background: #b91c1c; color: white; }
    .pill {
      background: #f1f5f9;
      border-radius: 999px;
      padding: 0.25rem 0.6rem;
      font-size: 0.85rem;
    }
    .footer { margin-top: 1.5rem; }
    .small { font-size: 0.85rem; }
    .success { color: #0f766e; }
    .error { color: #b91c1c; }
  </style>
</head>
<body>
  <h1>Values Survey: Present vs 2075</h1>
  <p class="hint">
    Click once inside each triangle to record the <strong>relative importance</strong> of three values:
    <span class="pill">Maximising AI Usage</span>,
    <span class="pill">Overcoming Climate Change</span>,
    <span class="pill">Global Human Equality</span>.
  </p>

  <div class="wrap">

    <!-- 2025 Plot -->
    <section class="card">
      <h2>Present Day (2025)</h2>
      <div id="plotPresent" class="plot"></div>
      <div class="controls">
        <span id="presentStatus" class="muted">Click once inside the triangle to select your point.</span>
        <button id="presentSubmit" class="ok" disabled>Submit 2025</button>
        <button id="presentReset" class="warn" disabled>Reset</button>
      </div>
      <form id="presentForm" method="POST" action="https://formspree.io/f/mkgpzkan" style="display:none">
        <input type="hidden" name="user_id" id="present_user_id">
        <input type="hidden" name="a" id="present_a">
        <input type="hidden" name="b" id="present_b">
        <input type="hidden" name="c" id="present_c">
        <input type="hidden" name="year" value="2025">
        <input type="hidden" name="timestamp" id="present_timestamp">
        <input type="text" name="_gotcha" style="display:none">
      </form>
    </section>

    <!-- 2075 Plot -->
    <section class="card">
      <h2>Future (2075)</h2>
      <div id="plotFuture" class="plot"></div>
      <div class="controls">
        <span id="futureStatus" class="muted">Click once inside the triangle to select your point.</span>
        <button id="futureSubmit" class="ok" disabled>Submit 2075</button>
        <button id="futureReset" class="warn" disabled>Reset</button>
      </div>
      <form id="futureForm" method="POST" action="https://formspree.io/f/mvgvqdng" style="display:none">
        <input type="hidden" name="user_id" id="future_user_id">
        <input type="hidden" name="a" id="future_a">
        <input type="hidden" name="b" id="future_b">
        <input type="hidden" name="c" id="future_c">
        <input type="hidden" name="year" value="2075">
        <input type="hidden" name="timestamp" id="future_timestamp">
        <input type="text" name="_gotcha" style="display:none">
      </form>
    </section>
  </div>

  <div class="footer small muted">
    <p><strong>Privacy:</strong> This survey is anonymous and used only for a UCD MIS20070 class project.</p>
    <p>AI assistance citation: “Assistance received from Digital Society Assistant (GPT-5), OpenAI.”</p>
  </div>

  <script>
    // === Helper functions ===
    function uuid() { return 'anon-' + Math.random().toString(36).slice(2, 10); }
    function nowISO() { return new Date().toISOString(); }
    function normalize(a,b,c){ const s=a+b+c; return [a/s,b/s,c/s]; }
    function pct(x){ return Math.round(x*1000)/10; }

    // Persistent anonymous user_id
    let USER_ID = localStorage.getItem('values_user_id');
    if(!USER_ID){ USER_ID = uuid(); localStorage.setItem('values_user_id', USER_ID); }

    const values = {A:'Maximising AI Usage', B:'Overcoming Climate Change', C:'Global Human Equality'};
    const layout = (title) => ({
      title, ternary: {
        sum:1,
        aaxis:{title:values.A, min:0},
        baxis:{title:values.B, min:0},
        caxis:{title:values.C, min:0}
      }, margin:{l:20,r:20,t:40,b:20}
    });

    function renderPlot(divId,title){
      Plotly.newPlot(divId,[{type:'scatterternary',a:[],b:[],c:[],mode:'markers',marker:{size:10}}],
        layout(title),{displayModeBar:false});
    }

    renderPlot('plotPresent', `Present (2025): ${values.A}/${values.B}/${values.C}`);
    renderPlot('plotFuture',  `Future (2075): ${values.A}/${values.B}/${values.C}`);

    const presentStatus=document.getElementById('presentStatus');
    const futureStatus=document.getElementById('futureStatus');
    const presentSubmit=document.getElementById('presentSubmit');
    const futureSubmit=document.getElementById('futureSubmit');
    const presentReset=document.getElementById('presentReset');
    const futureReset=document.getElementById('futureReset');

    let presentPoint=null, futurePoint=null;

    function setHidden(prefix,a,b,c,year){
      document.getElementById(`${prefix}_a`).value=a.toFixed(3);
      document.getElementById(`${prefix}_b`).value=b.toFixed(3);
      document.getElementById(`${prefix}_c`).value=c.toFixed(3);
      document.getElementById(`${prefix}_user_id`).value=USER_ID;
      document.getElementById(`${prefix}_timestamp`).value=nowISO();
    }

    // === Present plot click ===
    document.getElementById('plotPresent').on('plotly_click', (e)=>{
      const p=e.points?.[0]; if(!p) return;
      let [a,b,c]=normalize(p.a,p.b,p.c);
      presentPoint={a,b,c};
      Plotly.react('plotPresent',[{type:'scatterternary',a:[a],b:[b],c:[c],mode:'markers',marker:{size:10}}],layout('Present (2025)'));
      presentStatus.innerHTML=`${pct(a)}% ${values.A} · ${pct(b)}% ${values.B} · ${pct(c)}% ${values.C}`;
      setHidden('present',a,b,c,2025);
      presentSubmit.disabled=false; presentReset.disabled=false;
    });

    // === Future plot click ===
    document.getElementById('plotFuture').on('plotly_click', (e)=>{
      const p=e.points?.[0]; if(!p) return;
      let [a,b,c]=normalize(p.a,p.b,p.c);
      futurePoint={a,b,c};
      Plotly.react('plotFuture',[{type:'scatterternary',a:[a],b:[b],c:[c],mode:'markers',marker:{size:10}}],layout('Future (2075)'));
      futureStatus.innerHTML=`${pct(a)}% ${values.A} · ${pct(b)}% ${values.B} · ${pct(c)}% ${values.C}`;
      setHidden('future',a,b,c,2075);
      futureSubmit.disabled=false; futureReset.disabled=false;
    });

    // === Submit (Formspree POST) ===
    async function sendForm(formId,statusEl){
      const form=document.getElementById(formId);
      const resp=await fetch(form.action,{method:'POST',body:new FormData(form),headers:{'Accept':'application/json'}});
      if(resp.ok){ statusEl.innerHTML='Thanks! Response recorded.'; statusEl.classList.add('success'); }
      else { statusEl.innerHTML='Error submitting. Please try again.'; statusEl.classList.add('error'); }
    }

    presentSubmit.onclick=()=>sendForm('presentForm',presentStatus);
    futureSubmit.onclick=()=>sendForm('futureForm',futureStatus);

    // === Reset buttons ===
    presentReset.onclick=()=>{ renderPlot('plotPresent','Present (2025)'); presentStatus.innerHTML='Click once inside the triangle to select your point.'; presentSubmit.disabled=true; };
    futureReset.onclick=()=>{ renderPlot('plotFuture','Future (2075)'); futureStatus.innerHTML='Click once inside the triangle to select your point.'; futureSubmit.disabled=true; };
  </script>
</body>
</html>
